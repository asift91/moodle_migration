--- 
- name: "upgrade"
  apt:
    upgrade: true
  become: true
- 
  name: "install sshpass"
  apt:
    name: sshpass
    state: latest
  become: true
  
- 
  name: "generate sshkey"
  openssh_keypair:
    path: /home/azureadmin/.ssh/id_rsa
    group: azureadmin
    owner: azureadmin
    size: 4096
  become: yes
- 
  name: "copy file to remote host"
  command: "sshpass -p {{ tar_vm_password | quote }} ssh-copy-id -i /home/azureadmin/.ssh/id_rsa.pub -o StrictHostKeyChecking=no azureadmin@{{ tar_vm_ip | quote }}"
  
